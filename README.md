# Block Builder License Server

–°–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π Block Builder —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –¥–æ–º–µ–Ω–∞–º.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### ‚ö° Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# Windows
.\start.ps1

# macOS / Linux
./start.sh

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker-compose -f docker-compose.full.yml up -d --build
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **https://localhost** (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É)
- **https://api.blockbuilder** (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ hosts, —Å–º. QUICK_START.md)

> –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ Docker: [README_DOCKER.md](./README_DOCKER.md)
> –ë—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞: [QUICK_START.md](./QUICK_START.md)

### üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Docker

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
docker run -d --name bb-postgres -e POSTGRES_PASSWORD=password -e POSTGRES_DB=block_builder_licenses -p 5432:5432 postgres:15-alpine

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
copy env.example .env

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
npm run migrate

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ **http://localhost:3006** (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ Docker)

> **–° Docker**: API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É **https://api.blockbuilder**

## üì° API Endpoints

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏
```bash
POST /api/license/verify
Content-Type: application/json

{
  "key": "BB-PRO-1234-5678-ABCD"
}
```

**–í–∞–∂–Ω–æ:** –î–æ–º–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ HTTP –∑–∞–ø—Ä–æ—Å–∞ (`Host`, `Origin`, `Referer`). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Host` —Å –¥–æ–º–µ–Ω–æ–º, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º –∫ –ª–∏—Ü–µ–Ω–∑–∏–∏.

### –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏
```bash
POST /api/license/create
Content-Type: application/json

{
  "email": "customer@example.com",
  "type": "PRO",
  "domain": "example.com"
}
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–æ–º–µ–Ω–∞:**
- `example.com`
- `www.example.com` (–±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–∞–∫ `example.com`)
- `http://example.com`
- `https://www.example.com`
- `example.com:8080` (–ø–æ—Ä—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤:**
- –ü—Ä–æ—Ç–æ–∫–æ–ª (`http://`, `https://`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- –ü—Ä–µ—Ñ–∏–∫—Å `www.` —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏
- –ü–æ—Ä—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –î–æ–º–µ–Ω—ã `www.example.com` –∏ `example.com` —Å—á–∏—Ç–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```bash
GET /api/license/stats
```

### Webhook –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
POST /api/license/webhook
Content-Type: application/json

{
  "email": "customer@example.com",
  "domain": "example.com",
  "type": "PRO",
  "saleId": "sale_123"
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `DB_HOST` - —Ö–æ—Å—Ç PostgreSQL
- `DB_PORT` - –ø–æ—Ä—Ç PostgreSQL
- `DB_NAME` - –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `DB_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT
- `CORS_ORIGIN` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π origin –¥–ª—è CORS
- `PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3006)

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Rate limiting –¥–ª—è –≤—Å–µ—Ö endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Security headers
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- Health check endpoint: `/health`
- –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª –∏ –∫–æ–Ω—Å–æ–ª—å
- –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–π


## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ watch —Ä–µ–∂–∏–º–µ
npm run test:watch
```

## üìù –õ–æ–≥–∏

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `logs/`:
- `server.log` - –æ–±—â–∏–µ –ª–æ–≥–∏
- `error.log` - —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–º–µ–Ω–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏:

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞:** –î–æ–º–µ–Ω –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ HTTP –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:
   - `X-Forwarded-Host` (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –ø—Ä–æ–∫—Å–∏/nginx)
   - `Host`
   - `Origin`
   - `Referer`

2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:** –î–æ–º–µ–Ω –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º:
   - –ü—Ä–æ—Ç–æ–∫–æ–ª —É–¥–∞–ª—è–µ—Ç—Å—è (`http://`, `https://`)
   - –ü—Ä–µ—Ñ–∏–∫—Å `www.` —É–¥–∞–ª—è–µ—Ç—Å—è
   - –ü–æ—Ä—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
   - –ü—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É

3. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –¥–æ–º–µ–Ω–æ–º –∏–∑ –∑–∞–ø—Ä–æ—Å–∞.

**–ü—Ä–∏–º–µ—Ä—ã:**
- –õ–∏—Ü–µ–Ω–∑–∏—è –¥–ª—è `example.com` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å `www.example.com`, `Example.Com`, `http://example.com`
- –õ–∏—Ü–µ–Ω–∑–∏—è –¥–ª—è `example.com` –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è `example.ru` –∏–ª–∏ `subdomain.example.com`
